<html metal:use-macro="main_template">
  <body metal:fill-slot="body" tal:omit-tag>
    <!-- Toolbar -->
    <div class="topbar"
         ng-class="frame.visible && 'shown'"
         ng-mouseenter="showViewSort(true, true)">
      <div class="inner" ng-switch="!!session.persona">
        <a class="pull-right" href=""
           ng-click="sheet.show= true"
           ng-switch-when="false"
           ng-hide="sheet.show">Sign in</a>
        <div class="pull-right user-picker"
             ng-switch-default
             data-user-picker-model="session.persona"
             data-user-picker-options="session.personas">
        </div>

       <!-- Searchbar -->
       <div class="visual-search"
            query="search.query"
            facets="search.facets"
            values="search.values"
            onclear="search.show = false; search.clear()"
            onsearch="search.update(this)"
            ng-show="search.show"></div>
       <div ng-click="search.show = true" ng-hide="search.show">
         <div class="VS-search VS-search-collapsed">
           <div class="VS-search-box-wrapper VS-search-box">
             <div class="VS-icon VS-icon-search"></div>
           </div>
         </div>
       </div>
      </div>
      <!-- / Searchbar -->
    </div>
    <!-- / Toolbar -->

    <!-- Content -->
    <div id="wrapper" class="content">
      <!-- View Sort Controls -->
      <div class="viewsort"
           ng-mouseenter="showViewSort()"
           ng-mouseleave="showViewSort(false)"
           ng-show="viewState.showControls">
        <div class="dropdown">
          <span role="button"
                class="dropdown-toggle"
                data-toggle="dropdown"
                >{{viewState.view}}<span class="icon-triangle"></span>
          <ul class="dropdown-menu" role="menu">
            <li ng-repeat="view in views">
              <a href="" ng-click="applyView(view)">{{view}}</a>
            </li>
          </ul>
        </div>

        <div class="dropdown">
          <span role="button"
                class="dropdown-toggle"
                data-toggle="dropdown"
                >{{viewState.sort}}<span class="icon-triangle"></span>
          <ul class="dropdown-menu" role="menu">
            <li ng-repeat="sort in sorts">
              <a href="" ng-click="applySort(sort)">{{sort}}</a>
            </li>
          </ul>
        </div>
      </div>
      <!-- / View Sort Controls -->

      <!-- Account and Authentication -->
      <div class="sheet" ng-show="sheet.show">
        <span class="close icon-cancel"
              role="button"
              title="Close"
              ng-click="sheet.show = false"></span>
        <div class="auth form-vertical tabbable"
             data-tab-reveal="['forgot','activate']"
             on-success="authSuccess"
             on-timeout="authTimeout"
             ng-form="form"
             ng-model="sheet.tab">
          <metal:main use-macro="blocks['auth-tabs']" />
        </div>
      </div>
      <!-- / Account and Authentication -->

      <!-- Angular view -->
      <div ng-view="" whenscrolled="loadMore(10)"></div>
    </div>
    <!-- / Content -->

    <!-- Templates -->
    <script type="text/ng-template" id="annotation.html">
      <metal:main use-macro="load: annotation.html" />
    </script>
    <script type="text/ng-template" id="editor.html">
      <metal:main use-macro="load: editor.html" />
    </script>
    <script type="text/ng-template" id="markdown.html">
      <metal:main use-macro="load: markdown.html" />
    </script>
    <script type="text/ng-template" id="privacy.html">
      <metal:main use-macro="load: privacy.html" />
    </script>
    <script type="text/ng-template" id="userPicker.html">
      <metal:main use-macro="load: userPicker.html" />
    </script>
    <script type="text/ng-template" id="viewer.html">
      <metal:main use-macro="load: viewer.html" />
    </script>
    <script type="text/ng-template" id="page_search.html">
      <metal:main use-macro="load: page_search.html" />
    </script>
    <script type="text/ng-template" id="notification.html">
      <metal:main use-macro="load: notification.html" />
    </script>
  </body>
</html>
