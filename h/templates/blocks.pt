<metal:main define-macro="auth">
  <tal:block i18n:translate="" content="structure form" />
  <form tal:define="providers request.registry.velruse_providers | {}"
        tal:repeat="provider providers.values()"
        action="${request.route_url(provider.login_route)}"
        target="hPopout">
    <button class="${provider.name} login">${provider.name}</button>
  </form>
</metal:main>

<metal:main define-macro="auth-tabs">
  <!-- Login -->
  <form data-title="Sign in"
        data-value="login"
        class="form tab-pane"
        name="login"
        novalidate>

    <div class="form-field">
      <label class="form-label" for="field-username">Username:</label>
      <input class="form-input" type="text" id="field-username" name="username" value="" placeholder="bill"
      ng-model="model.username" ng-minlength="3"
      required autocapitalize="false" />
      <ul class="form-error-list" ng-show="login.username.$dirty && login.username.$invalid">
        <li class="form-error" ng-show="login.username.$error.required"
          >Please enter your username.</li>
        <li class="form-error" ng-show="login.username.$error.minlength"
          >Usernames are at least 3 characters.</li>
      </ul>
    </div>

    <div class="form-field">
      <label class="form-label" for="field-password">Password:</label>
      <input class="form-input" id="field-password" type="password" name="password" value="" placeholder="&bull;&bull;&bull;&bull;"
             ng-model="model.password"
             required autocapitalize="false" autocorrect="false" />
      <ul class="form-error-list" ng-show="login.password.$dirty && login.password.$invalid">
        <li class="form-error">Please enter your password.</li>
      </ul>
    </div>

    <div class="form-actions">
      <div class="form-actions-message">
        <a href="" ng-click="sheet.tab = 'forgot'">Forgotten your password</a> or
        <a href="" ng-click="sheet.tab = 'activate'"
          >have an activation code?</a>
      </div>
      <div class="form-actions-buttons">
        <button class="btn btn-primary" type="submit" name="login"
          ng-disabled="!login.$valid">Sign in</button>
      </div>
    </div>

  </form>
  <!-- / Login -->

  <!-- Register -->
  <form data-title="Create an account"
        data-value="register"
        class="form tab-pane"
        name="register"
        novalidate>

    <div class="form-field">
      <label class="form-label" for="field-register-username">Username:
        <span class="form-hint">(between 3 and 15 characters)</span>
      </label>
      <input id="field-register-username" class="form-input" type="text" name="username" value="" placeholder="bill"
             required autocapitalize="false" ng-model="model.username"
             ng-minlength="3" ng-maxlength="15"
             ng-pattern="/^[A-Za-z0-9._]+$/"
             ng-model-options="{updateOn: 'blur'}" />
      <ul class="form-error-list" ng-show="errors.register.username || (register.username.$dirty && register.username.$invalid)">
        <li class="form-error" ng-show="register.username.$error.required"
              >Please choose a username.</li>
        <li class="form-error" ng-show="register.username.$error.minlength"
              >Usernames must be at least 3 characters.</li>
        <li class="form-error" ng-show="register.username.$error.maxlength"
              >Usernames must be 15 characters at most.</li>
        <li class="form-error" ng-show="register.username.$error.pattern"
              >Only letters, numbers, underscore and dot are allowed.</li>
        <li class="form-error" ng-show="errors.register.username">{{errors.register.username}}</li>
      </ul>
    </div>

    <div class="form-field">
      <label class="form-label" for="field-register-email">Email Address:</label>
      <input id="field-register-email"  class="form-input" type="email" name="email"
             value="" placeholder="bill@example.com"
             ng-model="model.email" required autocapitalize="false"
             ng-model-options="{updateOn: 'blur'}" />
      <ul class="form-error-list" ng-show="errors.register.email || (register.email.$dirty && register.email.$invalid)">
        <li class="form-error" ng-show="register.email.$error.email"
              >Is this an email address?</li>
        <li class="form-error" ng-show="register.email.$error.required"
              >Please enter your email.</li>
        <li class="form-error" ng-show="errors.register.email">{{errors.register.email}}</li>
      </ul>
    </div>

    <div class="form-field">
      <label class="form-label" for="field-register-password">Password:
        <span class="form-hint">(at least two characters)</span>
      </label>
      <input id="field-register-password" class="form-input"
             type="password" name="password" value=""
             placeholder="&bull;&bull;&bull;&bull;&bull;&bull;&bull;&bull;"
             required autocapitalize="false" autocorrect="false"
             ng-minlength="2" ng-model="model.password"
             ng-model-options="{updateOn: 'blur'}" />
      <ul class="form-error-list" ng-show="errors.activate.code || (register.password.$dirty && register.password.$invalid)">
        <li class="form-error" ng-show="register.password.$error.required"
              >Please enter a password.</li>
        <li class="form-error" ng-show="register.password.$error.minlength"
              >Passwords must be at least 2 characters.</li>
        <li class="form-error" ng-show="errors.activate.code">{{errors.activate.code}}</li>
      </ul>
    </div>

    <div class="form-actions">
      <div class="form-actions-buttons">
        <button class="btn" type="submit" name="sign_up"
          ng-disabled="!register.$valid">Sign up</button>
      </div>
    </div>

  </form>
  <!-- / Register -->

  <!-- Forgot password -->
  <form data-title="Claim an account"
        data-value="forgot"
        class="tab-pane"
        name="forgot"
        novalidate>

    <p>Please enter your email address.</p>
    <!--Get Validation Code-->
    <input type="email" name="email" value="" placeholder="Email"
           required autocapitalize="false" ng-model="model.email" />
    <span slow-validate="email">
      <span ng-show="forgot.email.$error.email"
            >Is this an email address?</span>
      <span ng-show="forgot.email.$error.required"
            >Please enter your email.</span>
    </span>

    <input type="submit" name="forgot" value="Request access"
           ng-disabled="!forgot.$valid" />

  </form>
  <!-- / Forgot password -->

  <!-- Activate -->
  <form data-title="Activate an account"
        data-value="activate"
        class="tab-pane"
        name="activate"
        novalidate>

    <p>Enter an activation code and a new password.</p>

    <input type="text" name="code" value="" placeholder="Activation Code"
           required autocorrect="false" autocapitalize="false"
           ng-model="model.code" />
    <span slow-validate="code">Please enter your validation code.</span>
    <span>{{error.activate.code}}</span>

    <input type="password" name="password" value="" placeholder="New Password"
           required autocapitalize="false" autocorrect="false"
           ng-minlength="2" ng-model="model.password" />
    <span slow-validate="password">
      <span ng-show="activate.password.$error.required"
            >Please choose a password.</span>
      <span ng-show="activate.password.$error.minlength"
            >Passwords must be at least 2 characters.</span>
    </span>

    <input type="submit" name="activate" value="Activate"
           ng-disabled="!activate.$valid" />

  </form>
  <!--/ Activate -->

  <span>{{errors.session}}</span>

</metal:main>
