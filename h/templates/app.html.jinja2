{% extends "layouts/base.html.jinja2" %}

{% block base_tag %}
  {# the <base> tag is required by Angular JS when HTML 5 history is
     enabled. We shouldn't really need this because a given instance of the app
     only ever displays a single route.
   #}
  <base target="_top" href="/" />
{% endblock %}

{% block styles %}
  {% assets "app_css" %}
    <link rel="stylesheet" href="{{ ASSET_URL }}">
  {% endassets %}
{% endblock %}

{% block body_tag %}
{# ng-strict-di is a (harmless) noop until we upgrade to Angular 1.3 #}
<body ng-app="h" ng-strict-di ng-controller="AppController" ng-csp="">
{% endblock %}

{% block content %}
  <top-bar
    auth="auth"
    on-login="login()"
    on-logout="logout()"
    account-dialog="accountDialog"
    share-dialog="shareDialog"
    is-sidebar="::isSidebar"
    search-controller="search"
    sort-by="sort.name"
    sort-options="sort.options"
    on-change-sort-by="sort.name = sortBy"
  />
  </top-bar>

  <div class="create-account-banner" ng-if="isSidebar && auth.status === 'signed-out'">
    To annotate this document
    <a href="{{ request.route_path('register') }}" target="_blank">
      create a free account
    </a>
    or <a href="" ng-click="login()">sign in</a>
  </div>

  <div class="content" ng-cloak>
    <login-form ng-if="accountDialog.visible"
                on-close="accountDialog.visible=false"></login-form>
    <sidebar-tutorial ng-if="isSidebar"></sidebar-tutorial>
    <share-dialog ng-show="shareDialog.visible"></share-dialog>
    <main ng-view=""></main>
  </div>
{% endblock %}

{% block templates %}
  <script type="text/ng-template" id="annotation.html">
    {{ include_raw("h:templates/client/annotation.html") }}
  </script>
  <script type="text/ng-template" id="excerpt.html">
    {{ include_raw("h:templates/client/excerpt.html") }}
  </script>
  <script type="text/ng-template" id="group_list.html">
    {{ include_raw("h:templates/client/group_list.html") }}
  </script>
  <script type="text/ng-template" id="login_form.html">
    {{ include_raw("h:templates/client/login_form.html") }}
  </script>
  <script type="text/ng-template" id="markdown.html">
    {{ include_raw("h:templates/client/markdown.html") }}
  </script>
  <script type="text/ng-template" id="share_dialog.html">
    {{ include_raw("h:templates/client/share_dialog.html") }}
  </script>
  <script type="text/ng-template" id="viewer.html">
    {{ include_raw("h:templates/client/viewer.html") }}
  </script>
  <script type="text/ng-template" id="thread.html">
    {{ include_raw("h:templates/client/thread.html") }}
  </script>
  <script type="text/ng-template" id="dropdown_menu_btn.html">
    {{ include_raw("h:templates/client/dropdown_menu_btn.html") }}
  </script>
  <script type="text/ng-template" id="publish_annotation_btn.html">
    {{ include_raw("h:templates/client/publish_annotation_btn.html") }}
  </script>
  <script type="text/ng-template" id="search_status_bar.html">
    {{ include_raw("h:templates/client/search_status_bar.html") }}
  </script>
  <script type="text/ng-template" id="sidebar_tutorial.html">
    {{ include_raw("h:templates/client/sidebar_tutorial.html") }}
  </script>
  <script type="text/ng-template" id="signin_control.html">
    {{ include_raw("h:templates/client/signin_control.html") }}
  </script>
  <script type="text/ng-template" id="sort_dropdown.html">
    {{ include_raw("h:templates/client/sort_dropdown.html") }}
  </script>
  <script type="text/ng-template" id="top_bar.html">
    {{ include_raw("h:templates/client/top_bar.html") }}
  </script>
{% endblock %}

{# Override ga_pageview block to prevent a 'pageview' event from being sent to
   Google Analytics #}
{% block ga_pageview %}{% endblock %}

{% block scripts %}
  <script id="hypothesis-settings" type="application/json">
  {{ app_config | to_json }}
  </script>
  {% assets "app_js" %}
    <script src="{{ ASSET_URL }}"></script>
  {% endassets %}
{% endblock %}
